import{d as I,c as n,a as t,w as L,k as O,t as c,n as y,j as P,i as S,b as m,F as R,r as D,e as u,f as q,h as l}from"./runtime-dom.esm-bundler.Tm41KRj3.js";import{_ as J}from"./_plugin-vue_export-helper.DlAUqK2U.js";const U=I({__name:"FinalExam",setup(F,{expose:o}){o();const g=u(!1),e=u(!1),w=u(!1),h=u(20),i=u([]),s=u(0),r=u([]),_=u(!1),x=u([]),b=u(0);let f;const j=q(()=>i.value[s.value]),M=q(()=>x.value.filter((a,d)=>{const v=i.value[d];if(!v)return!1;const k=new Set(v.correctAnswers),p=new Set(a);return k.size===p.size&&[...k].every(C=>p.has(C))}).length),N=q(()=>{const a=b.value,d=Math.floor(a/3600),v=Math.floor(a%3600/60),k=a%60,p=String(v).padStart(2,"0"),C=String(k).padStart(2,"0");return d>0?`${d}:${p}:${C}`:`${v}:${C}`});async function A(){w.value=!0;try{let a=await fetch("/api/generate-final-exam");if(a.status===404&&(await fetch("/api/generate-final-exam",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({size:Number(h.value),minVotes:0,minRatio:0,balanced:!0})}),a=await fetch("/api/generate-final-exam")),!a.ok){window.location.href="/404";return}const d=await a.json(),v=Array.isArray(d?.questions)?d.questions:[];if(v.length===0){window.location.href="/404";return}i.value=v.slice(0,Number(h.value)),s.value=0,r.value=[],x.value=[],_.value=!1,g.value=!0,b.value=(i.value.length||Number(h.value))*120,f&&window.clearInterval(f),f=window.setInterval(()=>{b.value>0?b.value-=1:(f&&window.clearInterval(f),e.value=!0)},1e3)}catch{window.location.href="/404"}finally{w.value=!1}}function T(a){if(!_.value)if(j.value.isMultipleChoice){const d=r.value.indexOf(a);d>-1?r.value.splice(d,1):r.value.push(a)}else r.value=[a]}function E(){r.value.length!==0&&(_.value=!0,x.value[s.value]=[...r.value])}function Q(){s.value<i.value.length-1?(s.value++,r.value=[],_.value=!1):e.value=!0}function V(){s.value>0&&(s.value--,r.value=x.value[s.value]??[],_.value=x.value[s.value]!==void 0)}function B(){g.value=!1,e.value=!1,s.value=0,r.value=[],x.value=[],i.value=[],b.value=0,f&&window.clearInterval(f)}const z={isStarted:g,isComplete:e,loading:w,size:h,questions:i,index:s,selected:r,answered:_,userAnswers:x,remainingSeconds:b,get countdownTimer(){return f},set countdownTimer(a){f=a},current:j,correct:M,formattedTimeLeft:N,start:A,toggle:T,submit:E,next:Q,prev:V,restart:B};return Object.defineProperty(z,"__isScriptSetup",{enumerable:!1,value:!0}),z}}),G={key:0,class:"max-w-2xl mx-auto"},H={class:"card text-center"},K={class:"mb-6"},W=["disabled"],X={key:0},Y={key:1},Z={key:1,class:"max-w-3xl mx-auto"},$={class:"mb-8"},ee={class:"flex justify-between text-sm text-gray-600 mb-2"},te={class:"flex items-center gap-4"},se={class:"w-full bg-gray-200 rounded-full h-2"},ne={class:"card"},le={class:"mb-6"},oe={class:"flex justify-between items-start mb-4"},ae={class:"text-xl font-heading font-semibold text-gray-900"},re={key:0,class:"ml-2 text-sm text-blue-600 font-normal"},ie={class:"text-gray-700 text-lg"},ce={class:"space-y-3 mb-6"},de=["onClick","disabled"],ue={class:"flex items-center"},fe={class:"mr-3 flex-shrink-0"},ve={key:0,class:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20"},me={key:0,class:"w-2 h-2 bg-white rounded-full"},xe={class:"flex-1"},_e={class:"font-medium"},be={key:0,class:"ml-3"},he={key:0,class:"text-green-600"},ye={key:1,class:"text-red-600"},ge={class:"flex justify-between"},we={key:0},ke={key:1},pe={key:2,class:"max-w-2xl mx-auto"},Ce={class:"card text-center"},Se={class:"text-gray-700 mb-6"},qe={class:"font-semibold"};function je(F,o,g,e,w,h){return l(),n("div",null,[e.isStarted?e.isComplete?(l(),n("div",pe,[t("div",Ce,[o[7]||(o[7]=t("h2",{class:"text-3xl font-heading font-bold text-gray-900 mb-2"},"Exam Complete",-1)),t("p",Se,[o[5]||(o[5]=S("Score: ",-1)),t("span",qe,c(e.correct)+"/"+c(e.questions.length),1)]),t("div",{class:"flex gap-4 justify-center"},[t("button",{onClick:e.restart,class:"btn-secondary"},"Retake"),o[6]||(o[6]=t("a",{href:"/catalog",class:"btn-primary"},"Review Catalog",-1))])])])):(l(),n("div",Z,[t("div",$,[t("div",ee,[t("span",null,"Question "+c(e.index+1)+" of "+c(e.questions.length),1),t("div",te,[t("span",null,c(Math.round((e.index+1)/e.questions.length*100))+"% Complete",1),t("span",{class:y(e.remainingSeconds<=300?"text-red-600 font-semibold":"text-gray-800")},"⏱️ "+c(e.formattedTimeLeft),3)])]),t("div",se,[t("div",{class:"bg-primary h-2 rounded-full transition-all duration-300",style:P({width:(e.index+1)/e.questions.length*100+"%"})},null,4)])]),t("div",ne,[t("div",le,[t("div",oe,[t("h2",ae,[S(c(e.current.title)+" ",1),e.current.isMultipleChoice?(l(),n("span",re,"(Select Multiple)")):m("",!0)]),t("span",{class:y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.current.difficulty==="beginner"?"bg-green-100 text-green-800":e.current.difficulty==="intermediate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},c(e.current.difficulty),3)]),t("p",ie,c(e.current.question),1)]),t("div",ce,[(l(!0),n(R,null,D(e.current.options,(i,s)=>(l(),n("button",{key:s,onClick:r=>e.toggle(s),disabled:e.answered,class:y(["quiz-option w-full text-left",e.selected.includes(s)?"selected":"",e.answered&&e.current.correctAnswers.includes(s)?"correct":"",e.answered&&e.selected.includes(s)&&!e.current.correctAnswers.includes(s)?"incorrect":""])},[t("div",ue,[t("div",fe,[e.current.isMultipleChoice?(l(),n("div",{key:0,class:y(["w-4 h-4 border-2 rounded flex items-center justify-center",e.selected.includes(s)?"bg-blue-500 border-blue-500":"border-gray-300"])},[e.selected.includes(s)?(l(),n("svg",ve,o[3]||(o[3]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):m("",!0)],2)):(l(),n("div",{key:1,class:y(["w-4 h-4 border-2 rounded-full flex items-center justify-center",e.selected.includes(s)?"bg-blue-500 border-blue-500":"border-gray-300"])},[e.selected.includes(s)?(l(),n("div",me)):m("",!0)],2))]),t("div",xe,[t("span",_e,c(String.fromCharCode(65+s))+".",1),S(" "+c(i),1)]),e.answered?(l(),n("span",be,[e.current.correctAnswers.includes(s)?(l(),n("span",he,"✓")):e.selected.includes(s)?(l(),n("span",ye,"✗")):m("",!0)])):m("",!0)])],10,de))),128))]),t("div",ge,[e.index>0?(l(),n("button",{key:0,onClick:e.prev,class:"px-4 py-2 text-gray-600 hover:text-gray-900"},"← Previous")):m("",!0),o[4]||(o[4]=t("div",null,null,-1)),!e.answered&&e.selected.length>0?(l(),n("button",{key:1,onClick:e.submit,class:"btn-primary mr-4"},"Submit Answer")):m("",!0),e.answered?(l(),n("button",{key:2,onClick:e.next,class:"btn-primary"},[e.index<e.questions.length-1?(l(),n("span",we,"Next Question →")):(l(),n("span",ke,"Finish Exam"))])):m("",!0)])])])):(l(),n("div",G,[t("div",H,[t("div",K,[o[2]||(o[2]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Number of Questions",-1)),L(t("select",{"onUpdate:modelValue":o[0]||(o[0]=i=>e.size=i),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-primary focus:border-primary"},o[1]||(o[1]=[t("option",{value:"10"},"10 Questions",-1),t("option",{value:"20"},"20 Questions",-1),t("option",{value:"30"},"30 Questions",-1),t("option",{value:"50"},"50 Questions",-1)]),512),[[O,e.size]])]),t("button",{onClick:e.start,disabled:e.loading,class:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed"},[e.loading?(l(),n("span",X,"Preparing...")):(l(),n("span",Y,"Start Final Exam"))],8,W)])]))])}const Me=J(U,[["render",je]]);export{Me as default};
