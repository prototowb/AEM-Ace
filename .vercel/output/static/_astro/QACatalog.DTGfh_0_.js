import{d as z,c as a,a as t,F as b,r as _,n as x,w as E,v as F,b as m,e as y,o as D,f as J,g as P,h as n,i as V,t as l,j as H}from"./runtime-dom.esm-bundler.Tm41KRj3.js";import{_ as R}from"./_plugin-vue_export-helper.DlAUqK2U.js";const N=5,G=z({__name:"QACatalog",props:{categories:{}},setup(L,{expose:i}){i();const I=L,r=y(null),f=y(""),v=y([]),e=y(0),u=y(!0),g=y(!1),p=y({}),w=y("");function j(){try{const o=localStorage.getItem("aemace.votes");p.value=o?JSON.parse(o):{}}catch{p.value={}}}function k(){try{localStorage.setItem("aemace.votes",JSON.stringify(p.value))}catch{}}function Q(){try{const o=localStorage.getItem("aemace.sessionId");if(o)return o;const s=globalThis.crypto?.randomUUID?.()||`sess_${Math.random().toString(36).slice(2)}${Date.now()}`;return localStorage.setItem("aemace.sessionId",s),s}catch{return`sess_${Date.now()}`}}D(()=>{j(),w.value=Q()});async function O(o,s){const c=p.value[o._id]||0,d=c===s?0:s;C(o,c,d),p.value[o._id]=d,k();try{if(!(await fetch("/api/submit-vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({questionId:o._id,value:d,sessionId:w.value})})).ok)throw new Error("Vote failed")}catch{C(o,d,c),p.value[o._id]=c,k()}}function C(o,s,c){const d=o.upvotes??0,A=o.downvotes??0;let S=d,M=A;s===1&&(S-=1),s===-1&&(M-=1),c===1&&(S+=1),c===-1&&(M+=1),o.upvotes=Math.max(0,S),o.downvotes=Math.max(0,M),o.voteScore=(o.upvotes||0)-(o.downvotes||0)}const T=J(()=>{let o=v.value;if(r.value&&(o=o.filter(s=>s.category._id===r.value)),f.value.trim()){const s=f.value.toLowerCase();o=o.filter(c=>c.title.toLowerCase().includes(s)||c.question.toLowerCase().includes(s)||c.options.some(d=>d.toLowerCase().includes(s)))}return o});async function h(o=!1){if(!g.value){g.value=!0;try{const s=new URLSearchParams;s.set("offset",String(o?0:e.value)),s.set("limit",String(N)),r.value&&s.set("categoryId",r.value),f.value.trim()&&s.set("search",f.value.trim());const d=await(await fetch(`/api/questions?${s.toString()}`)).json();o&&(v.value=[]),v.value=[...v.value,...d.items],e.value=(o?0:e.value)+d.items.length,u.value=!!d.hasMore}finally{g.value=!1}}}function U(){h(!1)}P([r,f],()=>{e.value=0,u.value=!0,h(!0)}),D(()=>{h(!0)});const B={props:I,selectedCategory:r,searchQuery:f,questions:v,offset:e,limit:N,hasMore:u,isLoading:g,userVotes:p,sessionId:w,loadStoredVotes:j,persistVotes:k,getOrCreateSessionId:Q,onVoteClick:O,applyVoteLocally:C,filteredQuestions:T,fetchQuestions:h,loadMore:U};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),K={class:"mb-8"},W={class:"flex flex-wrap gap-4 justify-center"},X=["onClick"],Y={class:"ml-2 text-sm opacity-75"},Z={class:"mb-8"},$={class:"max-w-md mx-auto"},q={class:"relative"},ee={class:"grid gap-6"},te={class:"flex justify-between items-start mb-4"},oe={class:"text-lg font-heading font-semibold text-gray-900 mb-2"},re={key:0,class:"ml-2 text-sm text-blue-600 font-normal"},se={class:"flex flex-wrap gap-2"},ae={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},ne={class:"mb-4 flex items-center gap-3"},le=["onClick"],ie=["onClick"],ce={class:"ml-2 text-xs text-gray-500"},de={class:"mb-4"},ue={class:"text-gray-700 mb-4"},ge={class:"space-y-2"},me={class:"font-medium"},ye={key:0,class:"ml-2 text-green-600"},fe={key:0,class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},pe={class:"text-blue-800"},xe={key:1,class:"mt-4 flex flex-wrap gap-2"},ve={key:0,class:"text-center py-12"},he={key:1,class:"text-center py-6 text-gray-500"},be={key:2,class:"text-center mt-4"};function _e(L,i,I,r,f,v){return n(),a("div",null,[t("div",K,[t("div",W,[(n(!0),a(b,null,_(r.props.categories,e=>(n(),a("button",{key:e._id,onClick:u=>r.selectedCategory=e._id,class:x(["px-4 py-2 rounded-lg font-medium transition-colors duration-200",r.selectedCategory===e._id?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"])},[V(l(e.name)+" ",1),t("span",Y,"("+l(e.questionCount)+")",1)],10,X))),128)),t("button",{onClick:i[0]||(i[0]=e=>r.selectedCategory=null),class:x(["px-4 py-2 rounded-lg font-medium transition-colors duration-200",r.selectedCategory===null?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-200"])}," All Questions ",2)])]),t("div",Z,[t("div",$,[t("div",q,[i[2]||(i[2]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("svg",{class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),E(t("input",{"onUpdate:modelValue":i[1]||(i[1]=e=>r.searchQuery=e),type:"text",placeholder:"Search questions...",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-primary focus:border-primary"},null,512),[[F,r.searchQuery]])])])]),t("div",ee,[(n(!0),a(b,null,_(r.filteredQuestions,e=>(n(),a("div",{key:e._id,class:"card"},[t("div",te,[t("div",null,[t("h3",oe,[V(l(e.title)+" ",1),e.isMultipleChoice?(n(),a("span",re," (Multiple Answers) ")):m("",!0)]),t("div",se,[e.category?(n(),a("span",{key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:H({backgroundColor:e.category.color+"20",color:e.category.color})},l(e.category.name),5)):m("",!0),e.isMultipleChoice?(n(),a("span",ae,l(e.correctAnswers.length)+" correct answers ",1)):m("",!0)])]),t("span",{class:x(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.difficulty==="beginner"?"bg-green-100 text-green-800":e.difficulty==="intermediate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},l(e.difficulty),3)]),t("div",ne,[t("button",{class:x(["inline-flex items-center justify-center rounded-md border px-2 py-1 text-sm transition-colors",r.userVotes[e._id]===1?"bg-green-600 text-white border-green-600":"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"]),onClick:u=>r.onVoteClick(e,1),"aria-label":"Upvote"}," ▲ ",10,le),t("span",{class:x(["min-w-[3rem] text-center font-medium",(e.voteScore||0)>=0?"text-gray-900":"text-gray-700"])},l(e.voteScore??0),3),t("button",{class:x(["inline-flex items-center justify-center rounded-md border px-2 py-1 text-sm transition-colors",r.userVotes[e._id]===-1?"bg-red-600 text-white border-red-600":"bg-white text-gray-700 border-gray-200 hover:bg-gray-50"]),onClick:u=>r.onVoteClick(e,-1),"aria-label":"Downvote"}," ▼ ",10,ie),t("span",ce,l(e.upvotes??0)+" up • "+l(e.downvotes??0)+" down ",1)]),t("div",de,[t("p",ue,l(e.question),1),t("div",ge,[(n(!0),a(b,null,_(e.options,(u,g)=>(n(),a("div",{key:g,class:x(["p-3 rounded-lg border-2",e.correctAnswers.includes(g)?"border-green-500 bg-green-50 text-green-800":"border-gray-200 bg-gray-50"])},[t("span",me,l(String.fromCharCode(65+g))+".",1),V(" "+l(u)+" ",1),e.correctAnswers.includes(g)?(n(),a("span",ye,"✓")):m("",!0)],2))),128))])]),e.explanation?(n(),a("div",fe,[i[3]||(i[3]=t("h4",{class:"font-medium text-blue-900 mb-2"},"Explanation:",-1)),t("p",pe,l(e.explanation),1)])):m("",!0),e.tags&&e.tags.length>0?(n(),a("div",xe,[(n(!0),a(b,null,_(e.tags,u=>(n(),a("span",{key:u,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800"},l(u),1))),128))])):m("",!0)]))),128)),!r.isLoading&&r.filteredQuestions.length===0?(n(),a("div",ve,i[4]||(i[4]=[t("svg",{class:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No Questions Found",-1),t("p",{class:"text-gray-600"},"Try adjusting your search or filter criteria.",-1)]))):m("",!0),r.isLoading?(n(),a("div",he,"Loading...")):m("",!0),r.hasMore&&!r.isLoading?(n(),a("div",be,[t("button",{onClick:r.loadMore,class:"px-4 py-2 rounded-lg bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"}," Load more ")])):m("",!0)])])}const Ce=R(G,[["render",_e]]);export{Ce as default};
