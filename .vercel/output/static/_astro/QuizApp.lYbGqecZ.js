import{d as R,c as l,a as t,b as v,w as S,l as G,k as E,F as V,r as B,t as a,j as J,i as I,n as _,e as d,f as w,h as n}from"./runtime-dom.esm-bundler.Tm41KRj3.js";import{_ as K}from"./_plugin-vue_export-helper.DlAUqK2U.js";const H=R({__name:"QuizApp",props:{questions:{default:()=>[]},categories:{},showFinalExamToggle:{type:Boolean,default:!0}},setup(T,{expose:s}){s();const x=T,e=d(!1),k=d(!1),u=d(0),o=d([]),r=d([]),y=d(0),g=d([]),p=d(""),M=d(""),C=d(10),m=d([]),h=d(!1),j=d(!1),N=w(()=>m.value[u.value]),P=w(()=>o.value.length>0&&b.value),b=d(!1),q=w(()=>r.value.filter((i,f)=>{const c=m.value[f];if(!c)return!1;const Q=new Set(c.correctAnswers),A=new Set(i);return Q.size===A.size&&[...Q].every(Y=>A.has(Y))}).length),O=w(()=>m.value.length-q.value),z=w(()=>q.value/m.value.length*100),U=w(()=>g.value.length>0?g.value.reduce((i,f)=>i+f,0)/g.value.length:0),L=async()=>{if(h.value=!0,j.value){await F();return}let i=[];if(x.questions&&x.questions.length>0)i=[...x.questions];else try{const c=new URLSearchParams;c.set("limit","50"),p.value&&c.set("categoryId",p.value);const Q=await fetch(`/api/questions?${c.toString()}`);if(Q.ok){const A=await Q.json();i=Array.isArray(A?.items)?A.items:[]}}catch{}p.value&&(i=i.filter(c=>c.category._id===p.value)),M.value&&(i=i.filter(c=>c.difficulty===M.value));const f=i.sort(()=>Math.random()-.5);if(m.value=f.slice(0,Math.min(Number(C.value),f.length)),m.value.length===0){alert("No questions available for the selected criteria. Please try different settings."),h.value=!1;return}u.value=0,o.value=[],r.value=[],g.value=[],b.value=!1,e.value=!0,y.value=Date.now(),h.value=!1},F=async()=>{try{let i=await fetch("/api/generate-final-exam");if(i.status===404&&(await fetch("/api/generate-final-exam",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({size:Number(C.value),minVotes:10,minRatio:.7,balanced:!0})}),i=await fetch("/api/generate-final-exam")),!i.ok)throw new Error("Failed to load final exam");const f=await i.json(),c=Array.isArray(f?.questions)?f.questions:[];if(c.length===0){alert("No curated questions available yet. Collect more votes and try again."),h.value=!1;return}m.value=c.slice(0,Number(C.value)),u.value=0,o.value=[],r.value=[],g.value=[],b.value=!1,e.value=!0,y.value=Date.now()}catch{alert("Unable to start Final Exam right now.")}finally{h.value=!1}},D={props:x,isQuizStarted:e,isQuizComplete:k,currentQuestionIndex:u,selectedAnswers:o,userAnswers:r,startTime:y,questionTimes:g,selectedCategory:p,selectedDifficulty:M,numberOfQuestions:C,quizQuestions:m,loading:h,finalExamMode:j,currentQuestion:N,isAnswered:P,hasSubmittedAnswer:b,correctAnswers:q,incorrectAnswers:O,scorePercentage:z,averageTime:U,startQuiz:L,startFinalExam:F,toggleAnswer:i=>{if(!P.value)if(N.value.isMultipleChoice){const f=o.value.indexOf(i);f>-1?o.value.splice(f,1):o.value.push(i)}else o.value=[i]},submitAnswer:()=>{if(o.value.length===0)return;b.value=!0,r.value[u.value]=[...o.value];const i=(Date.now()-y.value)/1e3;g.value[u.value]=i},nextQuestion:()=>{u.value<m.value.length-1?(u.value++,o.value=[],b.value=!1,y.value=Date.now()):k.value=!0},previousQuestion:()=>{u.value>0&&(u.value--,o.value=r.value[u.value]??[],b.value=r.value[u.value]!==void 0)},getScoreMessage:()=>z.value>=80?"Excellent! You're ready for the exam!":z.value>=70?"Good job! A bit more study and you'll be ready.":z.value>=50?"Not bad, but you need more practice.":"Keep studying! You'll get there.",resetQuiz:()=>{e.value=!1,k.value=!1,u.value=0,o.value=[],r.value=[],g.value=[],b.value=!1,m.value=[]}};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),W={key:0,class:"max-w-2xl mx-auto"},X={class:"card text-center"},Z={key:0,class:"mb-6 flex items-center gap-3"},$={class:"mb-6"},ee=["disabled"],te=["value"],se={class:"mb-6"},oe={class:"mb-8"},le=["disabled"],ne=["disabled"],re={key:0},ie={key:1},ae={key:1,class:"max-w-3xl mx-auto"},ue={class:"mb-8"},de={class:"flex justify-between text-sm text-gray-600 mb-2"},ce={class:"w-full bg-gray-200 rounded-full h-2"},fe={class:"card"},ve={class:"mb-6"},me={class:"flex justify-between items-start mb-4"},ge={class:"text-xl font-heading font-semibold text-gray-900"},be={key:0,class:"ml-2 text-sm text-blue-600 font-normal"},xe={class:"flex gap-2"},ye={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},he={class:"text-gray-700 text-lg"},_e={key:0,class:"text-sm text-blue-600 mt-2"},we={class:"space-y-3 mb-6"},pe=["onClick","disabled"],Qe={class:"flex items-center"},Ae={class:"mr-3 flex-shrink-0"},ke={key:0,class:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20"},Ce={key:0,class:"w-2 h-2 bg-white rounded-full"},ze={class:"flex-1"},Se={class:"font-medium"},Me={key:0,class:"ml-3"},qe={key:0,class:"text-green-600"},Ee={key:1,class:"text-red-600"},Te={key:0,class:"p-4 bg-blue-50 rounded-lg border border-blue-200 mb-6"},je={class:"text-blue-800"},Ne={class:"flex justify-between"},Pe={key:0},Fe={key:1},De={key:2,class:"max-w-2xl mx-auto"},Ve={class:"card text-center"},Be={class:"mb-6"},Ie={class:"relative w-32 h-32 mx-auto mb-6"},Oe={class:"w-32 h-32 transform -rotate-90",viewBox:"0 0 36 36"},Ue=["stroke-dasharray"],Le={class:"absolute inset-0 flex items-center justify-center"},Ye={class:"text-2xl font-bold text-gray-900"},Re={class:"text-lg text-gray-600 mb-6"},Ge={class:"grid md:grid-cols-3 gap-4 mb-8"},Je={class:"bg-green-50 p-4 rounded-lg"},Ke={class:"text-2xl font-bold text-green-600"},He={class:"bg-red-50 p-4 rounded-lg"},We={class:"text-2xl font-bold text-red-600"},Xe={class:"bg-blue-50 p-4 rounded-lg"},Ze={class:"text-2xl font-bold text-blue-600"};function $e(T,s,x,e,k,u){return n(),l("div",null,[e.isQuizStarted?e.isQuizComplete?(n(),l("div",De,[t("div",Ve,[t("div",Be,[t("div",Ie,[(n(),l("svg",Oe,[s[15]||(s[15]=t("path",{class:"text-gray-200",stroke:"currentColor","stroke-width":"3",fill:"transparent",d:"M18 2.0845 A 15.9155 15.9155 0 0 1 18 33.9155 A 15.9155 15.9155 0 0 1 18 2.0845"},null,-1)),t("path",{class:_(e.scorePercentage>=70?"text-green-500":e.scorePercentage>=50?"text-yellow-500":"text-red-500"),stroke:"currentColor","stroke-width":"3",fill:"transparent","stroke-linecap":"round","stroke-dasharray":`${e.scorePercentage}, 100`,d:"M18 2.0845 A 15.9155 15.9155 0 0 1 18 33.9155 A 15.9155 15.9155 0 0 1 18 2.0845"},null,10,Ue)])),t("div",Le,[t("span",Ye,a(Math.round(e.scorePercentage))+"%",1)])]),s[16]||(s[16]=t("h2",{class:"text-3xl font-heading font-bold text-gray-900 mb-4"}," Quiz Complete! ",-1)),t("div",Re,[t("p",null,"You scored "+a(e.correctAnswers)+" out of "+a(e.quizQuestions.length)+" questions",1),t("p",{class:_(e.scorePercentage>=70?"text-green-600":e.scorePercentage>=50?"text-yellow-600":"text-red-600")},a(e.getScoreMessage()),3)])]),t("div",Ge,[t("div",Je,[t("div",Ke,a(e.correctAnswers),1),s[17]||(s[17]=t("div",{class:"text-sm text-green-700"},"Correct",-1))]),t("div",He,[t("div",We,a(e.incorrectAnswers),1),s[18]||(s[18]=t("div",{class:"text-sm text-red-700"},"Incorrect",-1))]),t("div",Xe,[t("div",Ze,a(Math.round(e.averageTime))+"s",1),s[19]||(s[19]=t("div",{class:"text-sm text-blue-700"},"Avg. Time",-1))])]),t("div",{class:"flex flex-col sm:flex-row gap-4 justify-center"},[t("button",{onClick:e.resetQuiz,class:"btn-primary"}," Take Another Quiz "),s[20]||(s[20]=t("a",{href:"/catalog",class:"btn-secondary"}," Review Q&A Catalog ",-1))])])])):(n(),l("div",ae,[t("div",ue,[t("div",de,[t("span",null,"Question "+a(e.currentQuestionIndex+1)+" of "+a(e.quizQuestions.length),1),t("span",null,a(Math.round((e.currentQuestionIndex+1)/e.quizQuestions.length*100))+"% Complete",1)]),t("div",ce,[t("div",{class:"bg-primary h-2 rounded-full transition-all duration-300",style:J({width:(e.currentQuestionIndex+1)/e.quizQuestions.length*100+"%"})},null,4)])]),t("div",fe,[t("div",ve,[t("div",me,[t("h2",ge,[I(a(e.currentQuestion.title)+" ",1),e.currentQuestion.isMultipleChoice?(n(),l("span",be," (Select Multiple) ")):v("",!0)]),t("div",xe,[e.currentQuestion.isMultipleChoice?(n(),l("span",ye,a(e.currentQuestion.correctAnswers.length)+" correct ",1)):v("",!0),t("span",{class:_(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",e.currentQuestion.difficulty==="beginner"?"bg-green-100 text-green-800":e.currentQuestion.difficulty==="intermediate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"])},a(e.currentQuestion.difficulty),3)])]),t("p",he,a(e.currentQuestion.question),1),e.currentQuestion.isMultipleChoice?(n(),l("p",_e," 💡 This question has multiple correct answers. Select all that apply. ")):v("",!0)]),t("div",we,[(n(!0),l(V,null,B(e.currentQuestion.options,(o,r)=>(n(),l("button",{key:r,onClick:y=>e.toggleAnswer(r),disabled:e.isAnswered,class:_(["quiz-option w-full text-left",e.selectedAnswers.includes(r)?"selected":"",e.isAnswered&&e.currentQuestion.correctAnswers.includes(r)?"correct":"",e.isAnswered&&e.selectedAnswers.includes(r)&&!e.currentQuestion.correctAnswers.includes(r)?"incorrect":""])},[t("div",Qe,[t("div",Ae,[e.currentQuestion.isMultipleChoice?(n(),l("div",{key:0,class:_(["w-4 h-4 border-2 rounded flex items-center justify-center",e.selectedAnswers.includes(r)?"bg-blue-500 border-blue-500":"border-gray-300"])},[e.selectedAnswers.includes(r)?(n(),l("svg",ke,s[12]||(s[12]=[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):v("",!0)],2)):(n(),l("div",{key:1,class:_(["w-4 h-4 border-2 rounded-full flex items-center justify-center",e.selectedAnswers.includes(r)?"bg-blue-500 border-blue-500":"border-gray-300"])},[e.selectedAnswers.includes(r)?(n(),l("div",Ce)):v("",!0)],2))]),t("div",ze,[t("span",Se,a(String.fromCharCode(65+r))+".",1),I(" "+a(o),1)]),e.isAnswered?(n(),l("span",Me,[e.currentQuestion.correctAnswers.includes(r)?(n(),l("span",qe,"✓")):e.selectedAnswers.includes(r)?(n(),l("span",Ee,"✗")):v("",!0)])):v("",!0)])],10,pe))),128))]),e.isAnswered&&e.currentQuestion.explanation?(n(),l("div",Te,[s[13]||(s[13]=t("h4",{class:"font-medium text-blue-900 mb-2"},"Explanation:",-1)),t("p",je,a(e.currentQuestion.explanation),1)])):v("",!0),t("div",Ne,[e.currentQuestionIndex>0?(n(),l("button",{key:0,onClick:e.previousQuestion,class:"px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors"}," ← Previous ")):v("",!0),s[14]||(s[14]=t("div",null,null,-1)),!e.isAnswered&&e.selectedAnswers.length>0?(n(),l("button",{key:1,onClick:e.submitAnswer,class:"btn-primary mr-4"}," Submit Answer ")):v("",!0),e.isAnswered?(n(),l("button",{key:2,onClick:e.nextQuestion,class:"btn-primary"},[e.currentQuestionIndex<e.quizQuestions.length-1?(n(),l("span",Pe," Next Question → ")):(n(),l("span",Fe," Finish Quiz "))])):v("",!0)])])])):(n(),l("div",W,[t("div",X,[s[11]||(s[11]=t("h2",{class:"text-2xl font-heading font-bold text-gray-900 mb-6"}," Choose Your Quiz Settings ",-1)),x.showFinalExamToggle?(n(),l("div",Z,[S(t("input",{id:"finalExamToggle",type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=o=>e.finalExamMode=o),class:"h-4 w-4 text-primary border-gray-300 rounded"},null,512),[[G,e.finalExamMode]]),s[4]||(s[4]=t("label",{for:"finalExamToggle",class:"text-sm text-gray-800"}," Use curated Final Exam (top-voted questions) ",-1))])):v("",!0),t("div",$,[s[6]||(s[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Select Category ",-1)),S(t("select",{"onUpdate:modelValue":s[1]||(s[1]=o=>e.selectedCategory=o),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary",disabled:e.finalExamMode},[s[5]||(s[5]=t("option",{value:""},"All Categories (Mixed Quiz)",-1)),(n(!0),l(V,null,B(e.props.categories,o=>(n(),l("option",{key:o._id,value:o._id},a(o.name)+" ("+a(o.questionCount||0)+" questions) ",9,te))),128))],8,ee),[[E,e.selectedCategory]])]),t("div",se,[s[8]||(s[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Number of Questions ",-1)),S(t("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>e.numberOfQuestions=o),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary"},s[7]||(s[7]=[t("option",{value:"5"},"5 Questions",-1),t("option",{value:"10"},"10 Questions",-1),t("option",{value:"15"},"15 Questions",-1),t("option",{value:"20"},"20 Questions",-1)]),512),[[E,e.numberOfQuestions]])]),t("div",oe,[s[10]||(s[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-3"}," Difficulty Level ",-1)),S(t("select",{"onUpdate:modelValue":s[3]||(s[3]=o=>e.selectedDifficulty=o),class:"block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary",disabled:e.finalExamMode},s[9]||(s[9]=[t("option",{value:""},"All Levels",-1),t("option",{value:"beginner"},"Beginner",-1),t("option",{value:"intermediate"},"Intermediate",-1),t("option",{value:"advanced"},"Advanced",-1)]),8,le),[[E,e.selectedDifficulty]])]),t("button",{onClick:e.startQuiz,disabled:e.loading,class:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed"},[e.loading?(n(),l("span",re,"Loading...")):(n(),l("span",ie,a(e.finalExamMode?"Start Final Exam":"Start Quiz"),1))],8,ne)])]))])}const at=K(H,[["render",$e]]);export{at as default};
